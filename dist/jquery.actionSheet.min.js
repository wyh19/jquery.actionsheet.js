(function(a){a.fn.ActionSheet=function(f){var i=this;if(i.length!=1){p.debug&&console.error("选择器错误，插件无法正常工作");return null}var m;var d;var p=a.extend({debug:false,mode:"list",url:"",data:null,imgBaseUrl:"",imgField:"",labelField:"",idField:"",clickType:"click",backgroundColor:"#333",color:"#fff",callback:null,trggerFirst:false},f);if(!p.data&&p.url==""){p.debug&&console.error("请配置url或data的值");return null}if(p.mode!=""&&p.mode!="grid"&&p.mode!="list"){p.debug&&console.error("请配置正确的mode值");return null}i.css("background-color",p.backgroundColor).css("color",p.color);var k=a('<div class="as-loading"><i>加载中</i></div>');i.addClass("actionSheet");i.append(k);var c=a('<div class="as-bg"></div>');i.parent().append(c);if(p.data){j(p.mode,p.data)}else{s(p.mode,p.url)}function s(u,t){a.ajax({url:t,beforeSend:function(){e()},success:function(w){var v;if(typeof w=="string"){v=a.parseJSON(w)}else{v=w}j(u,v);g()}})}function j(u,t){if(u=="grid"){o(u,t);l()}else{b(u,t);r()}}function o(u,t){a.each(t,function(v){i.append('<div class="as-grid-cell" data-id="'+t[v][p.idField]+'"><img class="as-grid-cell-logo" src="'+p.imgBaseUrl+t[v][p.imgField]+'" /><div class="as-grid-cell-label">'+t[v][p.labelField]+"</div></div>")});n(u);l();if(p.trggerFirst){a(".as-grid-cell").first().trigger(p.clickType)}}function l(){m=i.width();var u=parseInt(m/50);var t=parseInt(m/u);a(".as-grid-cell").width(t);a(".as-grid-cell-logo").width(t).height(t);d=i.height();i.css("bottom",-d+"px").show();c.hide()}function b(u,t){a.each(t,function(v){i.append('<div class="as-list-cell" data-id="'+t[v][p.idField]+'"><div class="as-list-cell-label">'+t[v][p.labelField]+"</div></div>")});n(u);r()}function r(){m=i.width();d=i.height();i.css("bottom",-d+"px").show()}function e(){k.show()}function g(){k.hide()}function h(){i.animate({bottom:-d+"px"},300);c.hide();a("body").css("overflow","auto")}function n(u){if(u=="grid"){a(window).resize(l)}c.on(p.clickType,function(){h()});var t="as-"+u+"-cell";i.on(p.clickType,function(w){var v;if(w.target.className==t){v=a(w.target)}else{if(w.target.parentNode.className==t){v=a(w.target.parentNode)}else{return}}v.addClass("as-"+u+"-cell-active").siblings().removeClass("as-"+u+"-cell-active");p.callback.call(null,v.data("id"));h()})}var q={show:function(){i.animate({bottom:0},300);a("body").css("overflow","hidden");c.show()},hide:h};return q}})(jQuery);